<!doctype html>
<html lang="ar" class="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>ุบุฑูุฉ ุงููุฏููุฉ</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div>๐๏ธ ูุฏููุฉ - ูุดุฑ ุงููุงููุฑุง ูุงููุงูู</div>
      <div class="toolbar">
        <button id="logoutBtn" class="btn danger">ุฎุฑูุฌ</button>
      </div>
    </header>

    <div class="container">
      <div class="card">
        <h3>ุชุฌููุฒ ุงูุงุชุตุงู</h3>

        <div class="small" id="hwStatus">ุฌุงุฑู ูุญุต ุงูุฃุฌูุฒุฉ...</div>
        <div class="grid cols-2" style="margin-top:8px">
          <div>
            <label>ุงููุงููุฑุง:</label>
            <select id="camSel" class="input"></select>
          </div>
          <div>
            <label>ุงููุงูู:</label>
            <select id="micSel" class="input"></select>
          </div>
        </div>

        <div class="toolbar" style="margin-top:6px">
          <button id="grantBtn" class="btn">ููุญ ุฅุฐู ุงููุงููุฑุง/ุงููุงูู</button>
          <button id="joinBtn" class="btn">ุงุชุตุงู</button>
          <button id="leaveBtn" class="btn secondary" disabled>ูุบุงุฏุฑุฉ</button>
        </div>

        <hr/>
        <div class="video-grid cols-1">
          <div class="video-tile">
            <video id="preview" autoplay playsinline muted></video>
            <div class="label">ุงููุนุงููุฉ</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ููุฏุฑ ูุฑู: ูุญุงูู ุชุญููู UMD ูุญููุงู ุซู ูู ูุฑุงูุง ููุซููุฉ -->
    <script>
    (async () => {
      if (window.livekit) return;
      const srcs = [
        '/vendor/livekit-client.umd.min.js',
        'https://cdnjs.cloudflare.com/ajax/libs/livekit-client/2.15.7/livekit-client.umd.js',
        'https://unpkg.com/@livekit/client@2.15.7/dist/livekit-client.umd.min.js',
      ];
      for (const src of srcs) {
        try {
          await new Promise((res, rej) => {
            const s = document.createElement('script');
            s.src = src; s.async = false;
            s.onload = () => res();
            s.onerror = () => rej(new Error('load failed: ' + src));
            document.head.appendChild(s);
          });
          if (window.livekit) { console.log('[LiveKit] loaded from', src); break; }
        } catch (e) { console.warn(e.message); }
      }
      if (!window.livekit) alert('LiveKit client did not load (missing UMD).');
    })();
    </script>

    <!-- ูููุงุชู -->
    <script src="/common.js"></script>
    <script src="/city.js"></script>
  </body>
</html>
